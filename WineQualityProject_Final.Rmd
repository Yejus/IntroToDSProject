---
title: "Wine Quality Data Project"
author: "Anant Jain, Eddie Lim, Joanas Tan, Rishav Koirala"
date: "11/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(e1071)
library(caret)
library(ROCR)
library(tidyverse)
library(tidyr)
library(broom)
library(rpart)
library(rpart.plot)

```

### Introduction 

**Data Information**  
The data set we have chosen are related to red and white variants of the Portuguese "Vinho Verde" wine. There are a total of 12 inputs variables obtained using physicochemical tests in the data set, which are: 
1 - fixed acidity  
2 - volatile acidity  
3 - citric acid  
4 - residual sugar  
5 - chlorides  
6 - free sulfur dioxide  
7 - total sulfur dioxide  
8 - density  
9 - pH  
10 - sulphates  
11 - alcohol  
Output variable (based on sensory data):  
12 - quality (score between 0 and 10)  

**Research Question**  
Can we predict with good accuracy the quality of wine for both the red and the white varieties by considering their chemical properties, and identify the most significant features that predict a good red wine or white wine? 

**Research Approach**  
To answer the research question, we will undertake the following approach:  

1. First, we will carry out Exploratory Data Analysis (EDA) on our datasets. This helps us to make decisions in building our classifers by examining what the data suggests, such as by looking if the chemical compounds appear to be different between the types of wine for example, and if the variables are correlated.  

This is done by:  
* Representing each variable as a boxplot  
* Scatterplot matrix  

2. Second, we will then build our classifiers which we will use to predict the quality of the wine. We will label the wine as `good` if it is above the median value of 6, and the wine as `bad` if it is equal to or lower than 6. Since this is a binary response variable, there are three suitable classifiers we have learnt which are: 
* Logistic Regression  
* Decision Tree  
* Naive Bayes  

Thus, we will build each of the classifer, evaluate their performance by looking at their ROC plots, as well as their AUC values, and then decide on which classifier is best suited to predict wine quality.  

3. Finally, we will also perform stepwise regression to identify what the most significant features are in predicting wine quality by performing stepwise regression.  


### Preparing the data 

```{r}
data_allwine <- read.csv("~/projects/yalenus/IntroToDSProject/wine.csv")
data_redwine <- read.csv("winequality-red.csv")
data_whitewine <- read.csv("winequality-white.csv")
```

### Exploratory Data Analysis (EDA)

**Boxplots of each variable by type of wine (red/white)**  

```{r}

# box-and-whiskers plot for each variable by type
par(mfrow=c(2,3))

for(i in 1:11){
  boxplot(data_allwine[,i] ~data_allwine$type, ylab = names(data_allwine)[i])
}
```

**Exploring Correlation Between Variables** 

TO ADD: exploration on correlation between variables + explanation on approach of dropping of variables (textbook)


Since the classifiers we are evaluating (Logistic Regression, Naive Bayes and Decision Trees) do not handle correlated features well, we can directly work with only the variables we have chose to keep in our dataset:

```{r}
# Retained variables for red 
# citric.acid + residual.sugar + chlorides + free.sulfur.dioxide + sulphates + alcohol

vars_red <- c("citric.acid", "residual.sugar", "chlorides", "free.sulfur.dioxide", "sulphates", "alcohol", "quality")
data_redwine_reduced <- data_redwine[vars_red]

# Retained variables for white
# fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides + free.sulfur.dioxide + sulphates

vars_white <- c("fixed.acidity", "volatile.acidity", "citric.acid", "residual.sugar", "chlorides", "free.sulfur.dioxide", "sulphates", "quality")
data_whitewine_reduced <- data_whitewine[vars_white]
```


### Building Predictors 

**Assign Labels**  
```{r}

# assign labels for red wine (full dataset)
data_red_wine_labelled <- mutate(data_redwine,
       label = case_when(
         quality > 6 ~ "good", 
         quality <= 6 ~ "bad"
       ))

# assign labels for white wine (full dataset)
data_white_wine_labelled <- mutate(data_whitewine,
                                label = case_when(
                                  quality > 6 ~ "good", 
                                  quality <= 6 ~ "bad"
                                ))


# assign labels for red wine (reduced dataset)
data_redwine_reduced_labelled <- mutate(data_redwine_reduced,
       label = case_when(
         quality > 6 ~ "good", 
         quality <= 6 ~ "bad"
       ))

# assign labels for white wine (reduced dataset)
data_whitewine_reduced_labelled <- mutate(data_whitewine_reduced,
                                label = case_when(
                                  quality > 6 ~ "good", 
                                  quality <= 6 ~ "bad"
                                ))


data_red_wine_labelled$label_binary <- as.numeric((data_red_wine_labelled$quality >6 ))
data_white_wine_labelled$label_binary <- as.numeric((data_white_wine_labelled$quality >6 ))

data_redwine_reduced_labelled$label_binary <- as.numeric((data_redwine_reduced_labelled$quality  >6 ))
data_whitewine_reduced_labelled$label_binary <- as.numeric((data_whitewine_reduced_labelled$quality >6 ))

```


**Data Partition** 
To compare the classifiers fairly, we will use the same partitioned training (80%) and testing (20%) data for all classifiers. 

```{r}

# Partition red wine full dataset
set.seed(100000)
indxTrain_red_full <- createDataPartition(y = data_red_wine_labelled$label ,p = 0.8,list = FALSE) 
traindata_red_full <- data_red_wine_labelled[indxTrain_red_full, !(names(data_red_wine_labelled) %in% c('quality'))]
testdata_red_full <- data_red_wine_labelled[-indxTrain_red_full, !(names(data_red_wine_labelled) %in% c('quality'))]

# Partition white wine full dataset
set.seed(100000)
indxTrain_white_full <- createDataPartition(y = data_white_wine_labelled$label ,p = 0.8,list = FALSE) 
traindata_white_full <- data_white_wine_labelled[indxTrain_white_full, !(names(data_white_wine_labelled) %in% c('quality'))]
testdata_white_full <- data_white_wine_labelled[-indxTrain_white_full, !(names(data_white_wine_labelled) %in% c('quality'))]


# Partition red wine reduced dataset
set.seed(100000)
indxTrain_red_reduced <- createDataPartition(y = data_redwine_reduced_labelled$label ,p = 0.8,list = FALSE) 
traindata_red_reduced <- data_redwine_reduced_labelled[indxTrain_red_reduced, !(names(data_redwine_reduced_labelled) %in% c('quality'))]
testdata_red_reduced <- data_redwine_reduced_labelled[-indxTrain_red_reduced, !(names(data_redwine_reduced_labelled) %in% c('quality'))]


# Partition white wine reduced dataset
set.seed(100000)
indxTrain_white_reduced <- createDataPartition(y = data_whitewine_reduced_labelled$label ,p = 0.8,list = FALSE) # uses random sampling
traindata_white_reduced <- data_whitewine_reduced_labelled[indxTrain_white_reduced, !(names(data_whitewine_reduced_labelled) %in% c('quality'))]
testdata_white_reduced <- data_whitewine_reduced_labelled[-indxTrain_white_reduced, !(names(data_whitewine_reduced_labelled) %in% c('quality'))]

```


**Naive Bayes**  
**White Wine**
``` {r}
### White Wine NB Analysis

nb_model_white <- naiveBayes(as.factor(label) ~ . - label_binary , traindata_white_full, laplace=.01)

nb_prediction_white <- predict(nb_model_white,
                         # remove column "label"
                         testdata_white_full[,!(names(data_white_wine_labelled) %in% c('label', 'label_binary'))],
                         type='raw') 

nb_score_white <- nb_prediction_white[, c("good")]

actual_class_white <- testdata_white_full$label == 'good' 
nb_pred_white <- prediction(nb_score_white, actual_class_white)
nb_perf_white <- performance(nb_pred_white, "tpr", "fpr")


```


``` {r}
plot(nb_perf_white, col="blue", lwd=2, xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```


``` {r}
nb_auc_white <- performance(nb_pred_white, "auc")
nb_auc_white <- unlist(slot(nb_auc_white, "y.values"))
nb_auc_white

```

**Red Wine**
``` {r}



nb_model_red <- naiveBayes(as.factor(label) ~ . - label_binary, traindata_red_full, laplace=.01)

nb_prediction_red <- predict(nb_model_red,
                         # remove column "label"
                         testdata_red_full[,!(names(data_red_wine_labelled) %in% c('label','label_binary'))],
                         type='raw') 

nb_score_red <- nb_prediction_red[, c("good")]

actual_class_red <- testdata_red_full$label == 'good' 
nb_pred_red <- prediction(nb_score_red, actual_class_red)
nb_perf_red <- performance(nb_pred_red, "tpr", "fpr")

```

``` {r}
plot(nb_perf_red, lwd=2, xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```

``` {r}
nb_auc_red <- performance(nb_pred_red, "auc")
nb_auc_red <- unlist(slot(nb_auc_red, "y.values"))
nb_auc_red
```


**Side-by-side Plot**

``` {r}
par(mfrow=c(1,2)) 
plot(nb_perf_red, col="red", lwd=2, main="Red Wine Quality Label NB Model Prediction Perf", xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
plot(nb_perf_white, col="blue", lwd=2, main="White Wine Quality Label NB Model Prediction Perf", xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```

**Multiple lines in single plot**
``` {r}
par(mfrow=c(1,1)) 
plot(nb_perf_red, col="red", lwd=2, main="Wine Quality Label NB Model Prediction Perf (Full Dataset)", xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)

# par(new = TRUE)  # We draw on top of the existing plot.
# plot(perf, col = "red", lwd=2, main="", xlab="", ylab="")

par(new = TRUE)  # We draw on top of the existing plot.
plot(nb_perf_white, col = "blue", lwd=2, main="", xlab="", ylab="")

legend("topleft",
       legend = c("Red Wine", "White Wine"),
       col = c("red", "blue"),
       pch = c(0, 0, 0))
```

**AUCs**
```{r}
print(paste0("AUC of NB Model (Red Wine):", nb_auc_red))
print(paste0("AUC of NB Model (White Wine):", nb_auc_white))
```

**Naive Bayes** 

**Logistic Regression** 

Aim: To predict whether the wine is above median quality or otherwise
    - Hence the response variable would be the binary variable whether the wine is “good” or “bad”
    
How we chose the predictors:
    - Full model with all the predictors
            - Violates the assumption that variables have to be independent from one another
            - Good for comparison
    - Remove correlated variables for a reduced model as per EDA
            - Fulfills all the assumptions
            
Split the data into training data and testing data into 80/20 percent of the dataset respectively.
     - Model is created using training data
     - ROC curve and AUC is derived using testing data
     - Done to ensure overfitting does not happen

**Red Wine** 

**Full Model** 

```{r}



red_lr_train <- glm(formula = label_binary ~ 
                fixed.acidity + volatile.acidity + citric.acid
              + residual.sugar + chlorides + free.sulfur.dioxide
              + total.sulfur.dioxide + density + pH 
              + sulphates + alcohol, data = traindata_red_full,
              family = binomial(link="logit"))

summary(red_lr_train)

pred = predict.glm(red_lr_train,testdata_red_full,  type="response")
predObj <- prediction(pred, testdata_red_full$label_binary)
rocObj = performance(predObj, measure="tpr", x.measure="fpr")
aucObj = performance(predObj, measure="auc")
plot(rocObj, main = paste("Area under the curve:",
round(aucObj@y.values[[1]] ,4)))

```

**Reduced Model** 

```{r}

red_lr_train_reduced <- glm(formula = label_binary ~ 
                 citric.acid
              + residual.sugar + chlorides + free.sulfur.dioxide
              + sulphates + alcohol, data = traindata_red_reduced,
              family = binomial(link="logit"))

summary(red_lr_train_reduced)

pred = predict.glm(red_lr_train_reduced, testdata_red_reduced,  type="response")
predObj <- prediction(pred, testdata_red_reduced$label_binary)
rocObj = performance(predObj, measure="tpr", x.measure="fpr")
aucObj = performance(predObj, measure="auc")
plot(rocObj, main = paste("Area under the curve:",
round(aucObj@y.values[[1]] ,4)))

```

```{r}

# Select only numeric predictors
mydata <- data_redwine_reduced_labelled %>%
  dplyr::select_if(is.numeric) 
predictors <- colnames(mydata)
probabilities <- predict(red_lr_train_reduced, newdata = data_redwine_reduced_labelled ,type = "response")
# Bind the logit and tidying the data for plot
mydata <- mydata %>%
  mutate(logit = log(probabilities/(1-probabilities))) %>%
  gather(key = "predictors", value = "predictor.value", -logit)

ggplot(mydata, aes(logit, predictor.value))+
  geom_point(size = 0.5, alpha = 0.5) +
  geom_smooth(method = "loess") + 
  theme_bw() + 
  facet_wrap(~predictors, scales = "free_y")


```



**White Wine** 

**Full Model** 

```{r}

white_lr_train <- glm(formula = label_binary ~ 
                fixed.acidity + volatile.acidity + citric.acid
              + residual.sugar + chlorides + free.sulfur.dioxide
              + total.sulfur.dioxide + density + pH 
              + sulphates + alcohol, data = traindata_white_full,
              family = binomial(link="logit"))

summary(white_lr_train)

pred = predict.glm(white_lr_train, testdata_white_full,  type="response")
predObj <- prediction(pred, testdata_white_full$label_binary)
rocObj = performance(predObj, measure="tpr", x.measure="fpr")
aucObj = performance(predObj, measure="auc")
plot(rocObj, main = paste("Area under the curve:",
round(aucObj@y.values[[1]] ,4)))

```

**Reduced Model** 

```{r}

white_lr_train_reduced <- glm(formula = label_binary ~ 
                fixed.acidity + volatile.acidity + citric.acid
              + residual.sugar + chlorides + free.sulfur.dioxide
              + sulphates, data = traindata_white_reduced,
              family = binomial(link="logit"))

summary(white_lr_train_reduced)

pred = predict.glm(white_lr_train_reduced, testdata_white_reduced,  type="response")
predObj <- prediction(pred, testdata_white_reduced$label_binary)
rocObj = performance(predObj, measure="tpr", x.measure="fpr")
aucObj = performance(predObj, measure="auc")
plot(rocObj, main = paste("Area under the curve:",
round(aucObj@y.values[[1]] ,4)))



```


```{r}

# Select only numeric predictors
mydata <- data_whitewine_reduced_labelled %>%
  dplyr::select_if(is.numeric) 
predictors <- colnames(mydata)
probabilities <- predict(white_lr_train_reduced, newdata = data_whitewine_reduced_labelled ,type = "response")
# Bind the logit and tidying the data for plot
mydata <- mydata %>%
  mutate(logit = log(probabilities/(1-probabilities))) %>%
  gather(key = "predictors", value = "predictor.value", -logit)

ggplot(mydata, aes(logit, predictor.value))+
  geom_point(size = 0.5, alpha = 0.5) +
  geom_smooth(method = "loess") + 
  theme_bw() + 
  facet_wrap(~predictors, scales = "free_y")


```



**Stepwise Regression** 

We use stepwise regression using logistic regression focusing on p-values in order to determine the significant variables that affect the quality of wine (using quality above median as the binary response variable)

Since we use logistic regression using stepwise regression, we must make sure that variables are independent from one another, i.e none of the variables are heavily correlated with each other, so we use the reduced predictor set as explained in our EDA.

We want the most significant variables, so the p-value threshold is set at 0.001.
Both backward elimination and forward selection are considered.


**Red Wine**

data_redwine_reduced_labelled

**Back Elimination**

```{r}

red_new_lr <- glm(formula = data_redwine_reduced_labelled$label_binary ~ 
               data_redwine_reduced_labelled$citric.acid
              + data_redwine_reduced_labelled$residual.sugar + data_redwine_reduced_labelled$chlorides + data_redwine_reduced_labelled$free.sulfur.dioxide
              + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$alcohol,
              family = binomial(link="logit"))

summary(red_new_lr)

```

As we can see residual.sugar has the highest p-val of 0.630051, so we remove it.

```{r}

red_new_lr_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ 
               data_redwine_reduced_labelled$citric.acid + data_redwine_reduced_labelled$chlorides + data_redwine_reduced_labelled$free.sulfur.dioxide
              + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$alcohol,
              family = binomial(link="logit"))

summary(red_new_lr_2)

```

As we can see free.sulfur.dioxide has the highest p-val of 0.026230, so we remove it.

```{r}

red_new_lr_3 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ 
               data_redwine_reduced_labelled$citric.acid + data_redwine_reduced_labelled$chlorides
              + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$alcohol,
              family = binomial(link="logit"))

summary(red_new_lr_3)

```

None of the variables have a p-value lower than 0.001, so we stop here.

Significant variables:
 - citric.acid
 - chlorides
 - sulphates
 - alcohol

**Forward Selection **


```{r}

red_lr_new_fs1_1 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$citric.acid,
              family = binomial(link="logit"))

red_lr_new_fs1_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$residual.sugar,
              family = binomial(link="logit"))

red_lr_new_fs1_3 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$chlorides,
              family = binomial(link="logit"))

red_lr_new_fs1_4 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$free.sulfur.dioxide,
              family = binomial(link="logit"))

red_lr_new_fs1_5 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$sulphates,
              family = binomial(link="logit"))

red_lr_new_fs1_6 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol,
              family = binomial(link="logit"))

summary(red_lr_new_fs1_1)$coef
summary(red_lr_new_fs1_2)$coef
summary(red_lr_new_fs1_3)$coef
summary(red_lr_new_fs1_4)$coef
summary(red_lr_new_fs1_5)$coef
summary(red_lr_new_fs1_6)$coef


```

As we can see alcohol has the lowest p-val of 9.756085e-45, so we include it.

```{r}

red_lr_new_fs2_1 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$citric.acid,
              family = binomial(link="logit"))

red_lr_new_fs2_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$residual.sugar,
              family = binomial(link="logit"))

red_lr_new_fs2_3 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$chlorides,
              family = binomial(link="logit"))

red_lr_new_fs2_4 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$free.sulfur.dioxide,
              family = binomial(link="logit"))

red_lr_new_fs2_5 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates,
              family = binomial(link="logit"))

summary(red_lr_new_fs2_1)$coef
summary(red_lr_new_fs2_2)$coef
summary(red_lr_new_fs2_3)$coef
summary(red_lr_new_fs2_4)$coef
summary(red_lr_new_fs2_5)$coef


```

As we can see sulphates has the lowest p-val of 1.598385e-13, so we include it.

```{r}

red_lr_new_fs3_1 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates +  data_redwine_reduced_labelled$citric.acid,
              family = binomial(link="logit"))

red_lr_new_fs3_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates +  data_redwine_reduced_labelled$residual.sugar,
              family = binomial(link="logit"))

red_lr_new_fs3_3 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates +  data_redwine_reduced_labelled$chlorides,
              family = binomial(link="logit"))

red_lr_new_fs3_4 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates +  data_redwine_reduced_labelled$free.sulfur.dioxide,
              family = binomial(link="logit"))


summary(red_lr_new_fs3_1)$coef
summary(red_lr_new_fs3_2)$coef
summary(red_lr_new_fs3_3)$coef
summary(red_lr_new_fs3_4)$coef


```

As we can see citric.acid has the lowest p-val of 3.853376e-08, so we include it.

```{r}


red_lr_new_fs4_1 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$citric.acid +  data_redwine_reduced_labelled$residual.sugar,
              family = binomial(link="logit"))

red_lr_new_fs4_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$citric.acid +  data_redwine_reduced_labelled$chlorides,
              family = binomial(link="logit"))

red_lr_new_fs4_3 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$citric.acid +  data_redwine_reduced_labelled$free.sulfur.dioxide,
              family = binomial(link="logit"))


summary(red_lr_new_fs4_1)$coef
summary(red_lr_new_fs4_2)$coef
summary(red_lr_new_fs4_3)$coef


```

As we can see chlorides has the lowest p-val of 6.075525e-04, so we include it.


```{r}


red_lr_new_fs5_1 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$citric.acid + data_redwine_reduced_labelled$chlorides +  data_redwine_reduced_labelled$residual.sugar,
              family = binomial(link="logit"))

red_lr_new_fs5_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$citric.acid + data_redwine_reduced_labelled$chlorides +  data_redwine_reduced_labelled$free.sulfur.dioxide,
              family = binomial(link="logit"))


summary(red_lr_new_fs5_1)$coef
summary(red_lr_new_fs5_2)$coef


```

As we can see, none of the variables have a p-value lower than 0.001, so we stop here.

Significant variables:
 - citric.acid
 - chlorides
 - sulphates
 - alcohol

**White Wine**


```{r}

white_lr_new_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ 
                data_whitewine_reduced_labelled$fixed.acidity + data_whitewine_reduced_labelled$volatile.acidity +
                  data_whitewine_reduced_labelled$citric.acid + data_whitewine_reduced_labelled$residual.sugar + data_whitewine_reduced_labelled$chlorides +
                  data_whitewine_reduced_labelled$free.sulfur.dioxide +  data_whitewine_reduced_labelled$sulphates,
              family = binomial(link="logit"))

summary(white_lr_new_1)

```

As we can see citric.acid has the highest p-val of 0.401049, so we remove it.

```{r}

white_lr_new_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ 
                data_whitewine_reduced_labelled$fixed.acidity + data_whitewine_reduced_labelled$volatile.acidity +
                   data_whitewine_reduced_labelled$residual.sugar + data_whitewine_reduced_labelled$chlorides +
                  data_whitewine_reduced_labelled$free.sulfur.dioxide +  data_whitewine_reduced_labelled$sulphates,
              family = binomial(link="logit"))

summary(white_lr_new_2)

```

As we can see free.sulfur.dioxide has the highest p-val of 0.105479, so we remove it.

```{r}

white_lr_new_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ 
                data_whitewine_reduced_labelled$fixed.acidity + data_whitewine_reduced_labelled$volatile.acidity +
                   data_whitewine_reduced_labelled$residual.sugar + data_whitewine_reduced_labelled$chlorides +  data_whitewine_reduced_labelled$sulphates,
              family = binomial(link="logit"))

summary(white_lr_new_3)

```

None of the variables have a p-value lower than 0.001, so we stop here.

Significant variables:
 - fixed.acidity 
 - volatile.acidity
 - residual.sugar 
 - chlorides
 - sulphates 

**Forward Selection**

```{r}

white_lr_new_fs1_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$fixed.acidity,
              family = binomial(link="logit"))

white_lr_new_fs1_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$volatile.acidity,
              family = binomial(link="logit"))

white_lr_new_fs1_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$citric.acid,
              family = binomial(link="logit"))

white_lr_new_fs1_4 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$residual.sugar,
              family = binomial(link="logit"))

white_lr_new_fs1_5 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides,
              family = binomial(link="logit"))

white_lr_new_fs1_6 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$free.sulfur.dioxide,
              family = binomial(link="logit"))

white_lr_new_fs1_7 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$sulphates,
              family = binomial(link="logit"))

summary(white_lr_new_fs1_1)$coef
summary(white_lr_new_fs1_2)$coef
summary(white_lr_new_fs1_3)$coef
summary(white_lr_new_fs1_4)$coef
summary(white_lr_new_fs1_5)$coef
summary(white_lr_new_fs1_6)$coef
summary(white_lr_new_fs1_7)$coef
```

As we can see  chlorides has the lowest p-val of 6.967899e-57, so we include it.

```{r}

white_lr_new_fs2_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$fixed.acidity,
              family = binomial(link="logit"))

white_lr_new_fs2_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity,
              family = binomial(link="logit"))

white_lr_new_fs2_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$citric.acid,
              family = binomial(link="logit"))

white_lr_new_fs2_4 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$residual.sugar,
              family = binomial(link="logit"))

white_lr_new_fs2_5 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$free.sulfur.dioxide,
              family = binomial(link="logit"))

white_lr_new_fs2_6 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides +  data_whitewine_reduced_labelled$sulphates,
              family = binomial(link="logit"))

summary(white_lr_new_fs2_1)$coef
summary(white_lr_new_fs2_2)$coef
summary(white_lr_new_fs2_3)$coef
summary(white_lr_new_fs2_4)$coef
summary(white_lr_new_fs2_5)$coef
summary(white_lr_new_fs2_6)$coef

```

As we can see volatile.acidity has the lowest p-val of 1.443031e-06, so we include it.

```{r}

white_lr_new_fs3_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity +  data_whitewine_reduced_labelled$fixed.acidity,
              family = binomial(link="logit"))

white_lr_new_fs3_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity +  data_whitewine_reduced_labelled$citric.acid,
              family = binomial(link="logit"))

white_lr_new_fs3_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity +  data_whitewine_reduced_labelled$residual.sugar,
              family = binomial(link="logit"))

white_lr_new_fs3_4 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity +  data_whitewine_reduced_labelled$free.sulfur.dioxide,
              family = binomial(link="logit"))

white_lr_new_fs3_5 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides +data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$sulphates,
              family = binomial(link="logit"))

summary(white_lr_new_fs3_1)$coef
summary(white_lr_new_fs3_2)$coef
summary(white_lr_new_fs3_3)$coef
summary(white_lr_new_fs3_4)$coef
summary(white_lr_new_fs3_5)$coef

```

As we can see fixed.acidity has the lowest p-val of 7.237755e-06, so we include it.

```{r}

white_lr_new_fs4_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +   data_whitewine_reduced_labelled$citric.acid,
              family = binomial(link="logit"))

white_lr_new_fs4_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$residual.sugar,
              family = binomial(link="logit"))

white_lr_new_fs4_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity + data_whitewine_reduced_labelled$free.sulfur.dioxide,
              family = binomial(link="logit"))

white_lr_new_fs4_4 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides +data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates,
              family = binomial(link="logit"))

summary(white_lr_new_fs4_1)$coef
summary(white_lr_new_fs4_2)$coef
summary(white_lr_new_fs4_3)$coef
summary(white_lr_new_fs4_4)$coef

```

As we can see sulphates has the lowest p-val of 5.265491e-05, so we include it.


```{r}

white_lr_new_fs5_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates +   data_whitewine_reduced_labelled$citric.acid,
              family = binomial(link="logit"))

white_lr_new_fs5_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates +  data_whitewine_reduced_labelled$residual.sugar,
              family = binomial(link="logit"))

white_lr_new_fs5_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates +  data_whitewine_reduced_labelled$free.sulfur.dioxide,
              family = binomial(link="logit"))

summary(white_lr_new_fs5_1)$coef
summary(white_lr_new_fs5_2)$coef
summary(white_lr_new_fs5_3)$coef

```

As we can see residual.sugar has the lowest p-val of 3.793700e-04, so we include it.


```{r}

white_lr_new_fs6_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates + data_whitewine_reduced_labelled$residual.sugar +  data_whitewine_reduced_labelled$citric.acid,
              family = binomial(link="logit"))

white_lr_new_fs6_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates + data_whitewine_reduced_labelled$residual.sugar +  data_whitewine_reduced_labelled$free.sulfur.dioxide,
              family = binomial(link="logit"))

summary(white_lr_new_fs6_1)$coef
summary(white_lr_new_fs6_2)$coef

```

None of the variables have a p-value lower than 0.001, so we stop here.

Significant variables:
 - chlorides
 - volatile.acidity
 - fixed.acidity 
 - sulphates
 - residual.sugar
 
 
 **Decision Trees**  
 
 
 
 








