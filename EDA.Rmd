---
title: Exploratory Data Analysis

---

## Step 0: Load the Data

Loading the data for red and white wines separately: 

```{r}
knitr::opts_chunk$set(error = TRUE)
red <- read.csv("./winequality-red.csv")
white <- read.csv("./winequality-white.csv")
```

Labeling the data

```{r}
red$label <- rep("red", nrow(red))
white$label <- rep("white", nrow(white))
total <- rbind(red, white)
total <- na.omit(total)
```

## Step 0: Distribution of the Quality of the Wines

How are the qualities for the wines distributed? 

```{r}
library(ggplot2)

quality_plot <- ggplot(total, aes(quality, label))
quality_plot + geom_boxplot(fill = c('pink', 'yellow')) + ggtitle("Wine Quality in the Dataset")+
xlab('Quality') + ylab('Wine Type')
```


## Step 1: Correlation Matrix of the predictors

```{r}
library('viridis')
corr_red <- cor(red[,c(1:11)])
corr_white <- cor(white[, c(1:11)])

col = colorRampPalette(c("blue", "white", "red")) (20)
colors = viridis(n = 256, option = 'inferno') (20)
```

Correlation graphs/Heat-maps of the predictors for the Red wine dataset: 

```{r}
library('PerformanceAnalytics')
red_map <- heatmap(x = corr_red, col = colors, symm = TRUE)
chart.Correlation(corr_red, histogram = TRUE, pch = 1)
```

And for White wines:
```{r}
white_map <- heatmap(x = corr_white, col = colors, symm = TRUE)
chart.Correlation(corr_red, histogram = TRUE, pch = 1)
```



## Step 2: Clustering the Wines 


The histograms of quality are not very different across the two wines. 
Why look at the two kinds of wine separately unless they are different?

Perform k-means here:
```{r}
library(plyr)
library(ggplot2)
library(cluster)
library(lattice)
library(graphics)
library(grid)
library(gridExtra)


kmdata <- as.matrix(total[c("fixed.acidity", "volatile.acidity", "citric.acid", 
"residual.sugar", "chlorides", "free.sulfur.dioxide", "total.sulfur.dioxide", "density",
"pH", "sulphates", "alcohol")])


#wss <- numeric(15)
#for (k in 1:15) wss[k] <- sum(kmeans(kmdata, centers = k, nstart = 25)$withinss)
#plot(1:15, wss, type = 'b', xlab = "Number of Clusters", ylab = "WSS")


km <- kmeans(kmdata, 2, nstart = 25)
```

Prepare for plotting here: 

```{r}
df = as.data.frame(kmdata)
df$cluster = factor(km$cluster)
centers = as.data.frame(km$centers)

g1 <- ggplot(data = df, aes(x = fixed.acidity, y = volatile.acidity, color = cluster)) + 
geom_point() + theme(legend.position = "right") + 
geom_point(data = centers, aes(x = fixed.acidity, y = volatile.acidity, color = as.factor(c(1,2))), size = 10, alpha = 0.3, show.legend = FALSE)

g2 <- ggplot(data = df, aes(x = citric.acid, y = residual.sugar, color = cluster)) + 
geom_point() + theme(legend.position = "right") + 
geom_point(data = centers, aes(x = citric.acid, y = residual.sugar, color = as.factor(c(1,2))), size = 10, alpha = 0.3, show.legend = FALSE)

g3 <- ggplot(data = df, aes(x = chlorides, y = free.sulfur.dioxide, color = cluster)) + 
geom_point() + theme(legend.position = "right") + 
geom_point(data = centers, aes(x = chlorides, y = free.sulfur.dioxide, color = as.factor(c(1,2))), size = 10, alpha = 0.3, show.legend = FALSE)

g4 <- ggplot(data = df, aes(x = total.sulfur.dioxide, y = density, color = cluster)) + 
geom_point() + theme(legend.position = "right") + 
geom_point(data = centers, aes(x = total.sulfur.dioxide, y = density, color = as.factor(c(1,2))), size = 10, alpha = 0.3, show.legend = FALSE)

g5 <- ggplot(data = df, aes(x = pH, y = sulphates, color = cluster)) + 
geom_point() + theme(legend.position = "right") + 
geom_point(data = centers, aes(x = pH, y = sulphates, color = as.factor(c(1,2))), size = 10, alpha = 0.3, show.legend = FALSE)

grid.arrange(g1, g2, g3, g4, g5, nrow = 5)
```

Due to the high-dimensionality of the data, the clusters aren't obvious in the plots except one. 

## Principal Components Analysis

```{r}
pca_red <- prcomp(red[,c("fixed.acidity", "volatile.acidity", "citric.acid", 
"residual.sugar", "chlorides", "free.sulfur.dioxide", "total.sulfur.dioxide", "density",
"pH", "sulphates", "alcohol")], scale. = TRUE, center = TRUE)

pca_white <- prcomp(white[,c("fixed.acidity", "volatile.acidity", "citric.acid", 
"residual.sugar", "chlorides", "free.sulfur.dioxide", "total.sulfur.dioxide", "density",
"pH", "sulphates", "alcohol")], scale. = TRUE, center = TRUE)

```

The first two PCAs in both the red wine and the white wine datasets don't explain much of the variance:

```{r}
summary(pca_red)
summary(pca_white)
nrow(total)
```

Plotting the PCAs: 

For red wine: 
```{r}
source('https://raw.githubusercontent.com/vqv/ggbiplot/master/R/ggbiplot.r')

source('https://raw.githubusercontent.com/vqv/ggbiplot/master/R/ggscreeplot.r')

ggbiplot(pca_red, obs.scale = 1, var.scale = 1) +
scale_color_discrete(name = '')+
theme(legend.direction = 'horizontal', legend.position = 'top')

```
And for white wine: 

```{r}

ggbiplot(pca_white, obs.scale = 1, var.scale = 1) +
scale_color_discrete(name = '') +
theme(legend.direction = 'horizontal', legend.position = 'top')
```

Let's see if there is any difference for both wines plotted together. 

PC1 vs. PC2 distinguishes between the two wines: 

```{r}
pca_total <- prcomp(total, scale. = TRUE, center = TRUE)

ggbiplot(pca_total, obs.scale = 1, var.scale = 1, groups = total$label, ellipse = TRUE) +
scale_color_discrete(name = '') +
theme(legend.direction = 'horizontal', legend.position = 'top')
```

PC1 vs. PC3: 

```{r}
ggbiplot(pca_total, obs.scale = 1, var.scale = 1, choices = c(1,3), groups = total$label, ellipse = TRUE) +
scale_color_discrete(name = '') +
theme(legend.direction = 'horizontal', legend.position = 'top')

```

PC1 vs. PC4:

```{r}
ggbiplot(pca_total, obs.scale = 1, var.scale = 1, choices = c(1,4), groups = total$label, ellipse = TRUE) +
scale_color_discrete(name = '') +
theme(legend.direction = 'horizontal', legend.position = 'top')
```