---
title: "Wine Quality Data Project"
author: "Anant Jain, Eddie Lim, Joanas Tan, Rishav Koirala"
date: "11/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(e1071)
library(caret)
library(ROCR)
library(tidyverse)
library(tidyr)
library(broom)
library(rpart)
library(rpart.plot)
library(plyr)
library(ggplot2)
library(cluster)
library(lattice)
library(graphics)
library(grid)
library(gridExtra)
library(gplots)
library(PerformanceAnalytics)
```

### Introduction 

**Data Information**  
The data set we have chosen are related to red and white variants of the Portuguese "Vinho Verde" wine. There are a total of 12 inputs variables obtained using physicochemical tests in the data set, which are: 
1 - fixed acidity  
2 - volatile acidity  
3 - citric acid  
4 - residual sugar  
5 - chlorides  
6 - free sulfur dioxide  
7 - total sulfur dioxide  
8 - density  
9 - pH  
10 - sulphates  
11 - alcohol  
Output variable (based on sensory data):  
12 - quality (score between 0 and 10)  

**Research Question**  
Can we predict with good accuracy the quality of wine for both the red and the white varieties by considering their chemical properties, and identify the most significant features that predict a good red wine or white wine? 

**Research Approach**  
To answer the research question, we will undertake the following approach:  

1. First, we will carry out Exploratory Data Analysis (EDA) on our datasets. This helps us to make decisions in building our classifers by examining what the data suggests, such as by looking if the chemical compounds appear to be different between the types of wine for example, and if the variables are correlated.  

This is done by:  
* Representing each variable as a boxplot  
* Scatterplot matrix  

2. Second, we will then build our classifiers which we will use to predict the quality of the wine. We will label the wine as `good` if it is above the median value of 6, and the wine as `bad` if it is equal to or lower than 6. Since this is a binary response variable, there are three suitable classifiers we have learnt which are: 
* Logistic Regression  
* Decision Tree  
* Naive Bayes  

Thus, we will build each of the classifer, evaluate their performance by looking at their ROC plots, as well as their AUC values, and then decide on which classifier is best suited to predict wine quality.  

3. Finally, we will also perform stepwise regression to identify what the most significant features are in predicting wine quality by performing stepwise regression.  


### Preparing the data 

```{r}
data_allwine <- read.csv("~/projects/yalenus/IntroToDSProject/wine.csv")
data_redwine <- read.csv("winequality-red.csv")
data_whitewine <- read.csv("winequality-white.csv")
```

### Exploratory Data Analysis (EDA)

First, we need to see if the red and the white wine data are significantly differnt from 
each other. To this end, we utilize two methods: k-means clustering and Principal Means Analysis (PCA)

Before that, we temporarily label the data as red or wine by adding an additional column to the datasets. 

```{r}
red$label <- rep("red", nrow(data_redwine))
white$label <- rep("white", nrow(data_whitewine))

total = data_allwine

total <- rbind(red, white)
total <- na.omit(total)
```


**Using k-means clustering to attempt to classify the total wine dataset**

```{r}
kmdata <- as.matrix(total[c("fixed.acidity", "volatile.acidity", "citric.acid", 
"residual.sugar", "chlorides", "free.sulfur.dioxide", "total.sulfur.dioxide", "density",
"pH", "sulphates", "alcohol")])

km <- kmeans(kmdata, 2, nstart = 25)
```
```
Because the dataset has 11 predictors, there are $^11C_2 = 55$ ways to plot pairs of predictors on a 2D-plane. 
We only select a few to plot below: 

```{r}
df = as.data.frame(kmdata)
df$cluster = factor(km$cluster)
centers = as.data.frame(km$centers)

g1 <- ggplot(data = df, aes(x = fixed.acidity, y = volatile.acidity, color = cluster)) + 
geom_point() + theme(legend.position = "right") + 
geom_point(data = centers, aes(x = fixed.acidity, y = volatile.acidity, color = as.factor(c(1,2))), size = 10, alpha = 0.3, show.legend = FALSE)

g2 <- ggplot(data = df, aes(x = citric.acid, y = residual.sugar, color = cluster)) + 
geom_point() + theme(legend.position = "right") + 
geom_point(data = centers, aes(x = citric.acid, y = residual.sugar, color = as.factor(c(1,2))), size = 10, alpha = 0.3, show.legend = FALSE)

g3 <- ggplot(data = df, aes(x = chlorides, y = free.sulfur.dioxide, color = cluster)) + 
geom_point() + theme(legend.position = "right") + 
geom_point(data = centers, aes(x = chlorides, y = free.sulfur.dioxide, color = as.factor(c(1,2))), size = 10, alpha = 0.3, show.legend = FALSE)

g4 <- ggplot(data = df, aes(x = total.sulfur.dioxide, y = density, color = cluster)) + 
geom_point() + theme(legend.position = "right") + 
geom_point(data = centers, aes(x = total.sulfur.dioxide, y = density, color = as.factor(c(1,2))), size = 10, alpha = 0.3, show.legend = FALSE)

g5 <- ggplot(data = df, aes(x = pH, y = sulphates, color = cluster)) + 
geom_point() + theme(legend.position = "right") + 
geom_point(data = centers, aes(x = pH, y = sulphates, color = as.factor(c(1,2))), size = 10, alpha = 0.3, show.legend = FALSE)

grid.arrange(g1, g2, g3, g4, g5, nrow = 5)
```

We see that several of the plots don't do a good job of separating the red and the white wines. In fact, only one of the above plots -- density vs. total sulfur dioxide -- shows 
some distinction between the two kinds of wine. We need a different method.

**Using Principal Components Analysis (PCA) for clustering the two wines**

We run a PCA on the combined dataset as follows:

```{r}
pca_total <- prcomp(total[,c(1:11)], scale. = TRUE, center = TRUE)

ggbiplot(pca_total, obs.scale = 1, var.scale = 1, groups = total$label, ellipse = TRUE) +
scale_color_discrete(name = '') +
theme(legend.direction = 'horizontal', legend.position = 'top')
```

PC1 vs. PC3: 

```{r}
ggbiplot(pca_total, obs.scale = 1, var.scale = 1, choices = c(1,3), groups = total$label, ellipse = TRUE) +
scale_color_discrete(name = '') +
theme(legend.direction = 'horizontal', legend.position = 'top')

```

PC1 vs. PC4:

```{r}
ggbiplot(pca_total, obs.scale = 1, var.scale = 1, choices = c(1,4), groups = total$label, ellipse = TRUE) +
scale_color_discrete(name = '') +
theme(legend.direction = 'horizontal', legend.position = 'top')
```

As we can see, several of the Principal Components do a decent job of separating out the red wines and the white wines. This motivates us to analyze each type of wine 
separately for the rest of our project. 


**Exploring Correlation Between Variables** 

Correlated predictors are the bane of data analysis. Most of our classification methods require that the predictors in the model be as uncorrelated as possible. 
To that end, we use the strategy of removing one predictor variable from every pair of highly correlated variables in the dataset. 

```{r}
corr_red <- cor(data_redwine[,c(1:11)])
corr_white <- cor(data_whitewine[, c(1:11)])
```

Correlation graphs/Heat-maps of the predictors for the Red wine dataset: 

```{r}
library('gplots')
library('PerformanceAnalytics')
red_map <- heatmap.2(x = corr_red, col = rev(heat.colors(16)), symm = TRUE, dendrogram = 'none', 
trace = 'none', main = "Correlation Matrix for Red Wines", key = TRUE,
 lmat=rbind( c(0, 3), c(2,1), c(0,4) ), lhei=c(1.5,4,1.5), lwid = c(0.5,3), srtRow = 10, srtCol = 20, symkey = TRUE, key.title = NA,
 tracecol = 'blue')
chart.Correlation(corr_red, histogram = TRUE, pch = 1)
```

And for White wines:
```{r}
white_map <- heatmap.2(x = corr_white, col = rev(heat.colors(16)), symm = TRUE, dendrogram = 'none', 
trace = 'none', main = "Correlation Matrix for White Wines", key = TRUE,
 lmat=rbind( c(0, 3), c(2,1), c(0,4) ), lhei=c(1.5,4,1.5), lwid = c(0.5,3), srtRow = 10, srtCol = 20, symkey = TRUE, key.title = NA,
 tracecol = 'blue')
chart.Correlation(corr_white, histogram = TRUE, pch = 1)
```

Some predictors are highly correlated in both datasets (>50%). Moreover, some of them are not the same pairs 
across both datasets. We use the strategy described above and remove the correlated variables that have a single red asterisk (*) or more in the 
correlation charts above. 


This leads us to a filtered set of less correlated predictors to use for the rest of our analyses: 


```{r}
# Retained variables for red 
# citric.acid + residual.sugar + chlorides + free.sulfur.dioxide + sulphates + alcohol

vars_red <- c("citric.acid", "residual.sugar", "chlorides", "free.sulfur.dioxide", "sulphates", "alcohol", "quality")
data_redwine_reduced <- data_redwine[vars_red]

# Retained variables for white
# fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides + free.sulfur.dioxide + sulphates

vars_white <- c("fixed.acidity", "volatile.acidity", "citric.acid", "residual.sugar", "chlorides", "free.sulfur.dioxide", "sulphates", "quality")
data_whitewine_reduced <- data_whitewine[vars_white]
```


**The new correlation heatmaps**

First let's create a correlation matrix

```{r}
corr_red_new <- cor(data_redwine_reduced)
corr_white_new <- cor(data_whitewine_reduced)
```

The new correlation heat map for red wines: 
```{r}
red_map_new <- heatmap.2(x = corr_red_new, col = rev(heat.colors(16)), symm = TRUE, dendrogram = 'none', 
trace = 'none', main = "Correlation Matrix for Red Wines (New)", key = TRUE,
 lmat=rbind( c(0, 3), c(2,1), c(0,4) ), lhei=c(1.5,4,1.5), lwid = c(0.5,3), srtRow = 10, srtCol = 20, symkey = TRUE, key.title = NA,
 tracecol = 'blue')
```

Similarly for white wines: 

```{r}
white_map_new <- heatmap.2(x = corr_white_new, col = rev(heat.colors(16)), symm = TRUE, dendrogram = 'none', 
trace = 'none', main = "Correlation Matrix for White Wines (New)", key = TRUE,
 lmat=rbind( c(0, 3), c(2,1), c(0,4) ), lhei=c(1.5,4,1.5), lwid = c(0.5,3), srtRow = 10, srtCol = 20, symkey = TRUE, key.title = NA,
 tracecol = 'blue')
```

### Building Predictors 

**Assign Labels**  
  ```{r}

# assign labels for red wine (full dataset)
data_red_wine_labelled <- mutate(data_redwine,
                                 label = case_when(
                                   quality > 6 ~ "good", 
                                   quality <= 6 ~ "bad"
                                 ))

# assign labels for white wine (full dataset)
data_white_wine_labelled <- mutate(data_whitewine,
                                   label = case_when(
                                     quality > 6 ~ "good", 
                                     quality <= 6 ~ "bad"
                                   ))


# assign labels for red wine (reduced dataset)
data_redwine_reduced_labelled <- mutate(data_redwine_reduced,
                                        label = case_when(
                                          quality > 6 ~ "good", 
                                          quality <= 6 ~ "bad"
                                        ))

# assign labels for white wine (reduced dataset)
data_whitewine_reduced_labelled <- mutate(data_whitewine_reduced,
                                          label = case_when(
                                            quality > 6 ~ "good", 
                                            quality <= 6 ~ "bad"
                                          ))


data_red_wine_labelled$label_binary <- as.numeric((data_red_wine_labelled$quality >6 ))
data_white_wine_labelled$label_binary <- as.numeric((data_white_wine_labelled$quality >6 ))

data_redwine_reduced_labelled$label_binary <- as.numeric((data_redwine_reduced_labelled$quality  >6 ))
data_whitewine_reduced_labelled$label_binary <- as.numeric((data_whitewine_reduced_labelled$quality >6 ))

```


**Data Partition** 
  To compare the classifiers fairly, we will use the same partitioned training (80%) and testing (20%) data for all classifiers. 

```{r}

# Partition red wine full dataset
set.seed(100000)
indxTrain_red_full <- createDataPartition(y = data_red_wine_labelled$label ,p = 0.8,list = FALSE) 
traindata_red_full <- data_red_wine_labelled[indxTrain_red_full, !(names(data_red_wine_labelled) %in% c('quality'))]
testdata_red_full <- data_red_wine_labelled[-indxTrain_red_full, !(names(data_red_wine_labelled) %in% c('quality'))]

# Partition white wine full dataset
set.seed(100000)
indxTrain_white_full <- createDataPartition(y = data_white_wine_labelled$label ,p = 0.8,list = FALSE) 
traindata_white_full <- data_white_wine_labelled[indxTrain_white_full, !(names(data_white_wine_labelled) %in% c('quality'))]
testdata_white_full <- data_white_wine_labelled[-indxTrain_white_full, !(names(data_white_wine_labelled) %in% c('quality'))]


# Partition red wine reduced dataset
set.seed(100000)
indxTrain_red_reduced <- createDataPartition(y = data_redwine_reduced_labelled$label ,p = 0.8,list = FALSE) 
traindata_red_reduced <- data_redwine_reduced_labelled[indxTrain_red_reduced, !(names(data_redwine_reduced_labelled) %in% c('quality'))]
testdata_red_reduced <- data_redwine_reduced_labelled[-indxTrain_red_reduced, !(names(data_redwine_reduced_labelled) %in% c('quality'))]


# Partition white wine reduced dataset
set.seed(100000)
indxTrain_white_reduced <- createDataPartition(y = data_whitewine_reduced_labelled$label ,p = 0.8,list = FALSE) # uses random sampling
traindata_white_reduced <- data_whitewine_reduced_labelled[indxTrain_white_reduced, !(names(data_whitewine_reduced_labelled) %in% c('quality'))]
testdata_white_reduced <- data_whitewine_reduced_labelled[-indxTrain_white_reduced, !(names(data_whitewine_reduced_labelled) %in% c('quality'))]

```


**Naive Bayes**  
  
  **White Wine (Reduced Dataset)**
  ``` {r}
### White Wine NB Analysis

nb_model_white_reduced <- naiveBayes(as.factor(label) ~ . - label_binary , traindata_white_reduced, laplace=.01)

nb_prediction_white_reduced <- predict(nb_model_white_reduced,
                                       # remove column "label" and "label_binary"
                                       testdata_white_full[,!(names(data_whitewine_reduced_labelled) %in% c('label', 'label_binary'))],
                                       type='raw') 

nb_score_white_reduced <- nb_prediction_white_reduced[, c("good")]

actual_class_white_reduced <- testdata_white_reduced$label == 'good' 
nb_pred_white_reduced <- prediction(nb_score_white_reduced, actual_class_white_reduced)
nb_perf_white_reduced <- performance(nb_pred_white_reduced, "tpr", "fpr")


```


``` {r}
plot(nb_perf_white_reduced, col="blue", lwd=2, xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```


``` {r}
nb_auc_white_reduced <- performance(nb_pred_white_reduced, "auc")
nb_auc_white_reduced <- unlist(slot(nb_auc_white_reduced, "y.values"))
nb_auc_white_reduced

```

**Red Wine (Reduced Dataset)**
  ``` {r}
nb_model_red_reduced <- naiveBayes(as.factor(label) ~ . - label_binary, traindata_red_reduced, laplace=.01)

nb_prediction_red_reduced <- predict(nb_model_red_reduced,
                                     # remove column "label"
                                     testdata_red_full[,!(names(data_redwine_reduced_labelled) %in% c('label','label_binary'))],
                                     type='raw') 

nb_score_red_reduced <- nb_prediction_red_reduced[, c("good")]

actual_class_red_reduced <- testdata_red_reduced$label == 'good' 
nb_pred_red_reduced <- prediction(nb_score_red_reduced, actual_class_red_reduced)
nb_perf_red_reduced <- performance(nb_pred_red_reduced, "tpr", "fpr")

```

``` {r}
plot(nb_perf_red_reduced, lwd=2, xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```

``` {r}
nb_auc_red_reduced <- performance(nb_pred_red_reduced, "auc")
nb_auc_red_reduced <- unlist(slot(nb_auc_red_reduced, "y.values"))
nb_auc_red_reduced
```


**Side-by-side Plot**
  
  ``` {r}
par(mfrow=c(1,2)) 
plot(nb_perf_red_reduced, col="red", lwd=2, main="Red Wine Quality Label NB Model Prediction Perf", xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
plot(nb_perf_white_reduced, col="blue", lwd=2, main="White Wine Quality Label NB Model Prediction Perf", xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```

**Multiple lines in single plot**
  ``` {r}
par(mfrow=c(1,1)) 
plot(nb_perf_red_reduced, col="red", lwd=2, main="Wine Quality Label NB Model Prediction Perf (Reduced Dataset)", xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)

# par(new = TRUE)  # We draw on top of the existing plot.
# plot(perf, col = "red", lwd=2, main="", xlab="", ylab="")

par(new = TRUE)  # We draw on top of the existing plot.
plot(nb_perf_white_reduced, col = "blue", lwd=2, main="", xlab="", ylab="")

legend("topleft",
       legend = c("Red Wine", "White Wine"),
       col = c("red", "blue"),
       pch = c(0, 0, 0))
```


**White Wine**
  ``` {r}
### White Wine NB Analysis

nb_model_white <- naiveBayes(as.factor(label) ~ . - label_binary , traindata_white_full, laplace=.01)

nb_prediction_white <- predict(nb_model_white,
                               # remove column "label"
                               testdata_white_full[,!(names(data_white_wine_labelled) %in% c('label', 'label_binary'))],
                               type='raw') 

nb_score_white <- nb_prediction_white[, c("good")]

actual_class_white <- testdata_white_full$label == 'good' 
nb_pred_white <- prediction(nb_score_white, actual_class_white)
nb_perf_white <- performance(nb_pred_white, "tpr", "fpr")


```


``` {r}
plot(nb_perf_white, col="blue", lwd=2, xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```


``` {r}
nb_auc_white <- performance(nb_pred_white, "auc")
nb_auc_white <- unlist(slot(nb_auc_white, "y.values"))
nb_auc_white

```

**Red Wine**
  ``` {r}



nb_model_red <- naiveBayes(as.factor(label) ~ . - label_binary, traindata_red_full, laplace=.01)

nb_prediction_red <- predict(nb_model_red,
                             # remove column "label"
                             testdata_red_full[,!(names(data_red_wine_labelled) %in% c('label','label_binary'))],
                             type='raw') 

nb_score_red <- nb_prediction_red[, c("good")]

actual_class_red <- testdata_red_full$label == 'good' 
nb_pred_red <- prediction(nb_score_red, actual_class_red)
nb_perf_red <- performance(nb_pred_red, "tpr", "fpr")

```

``` {r}
plot(nb_perf_red, lwd=2, xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```

``` {r}
nb_auc_red <- performance(nb_pred_red, "auc")
nb_auc_red <- unlist(slot(nb_auc_red, "y.values"))
nb_auc_red
```


**Side-by-side Plot**
  
  ``` {r}
par(mfrow=c(1,2))
plot(nb_perf_red, col="red", lwd=2, main="Red Wine Quality Label NB Model Prediction Perf", xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
plot(nb_perf_white, col="blue", lwd=2, main="White Wine Quality Label NB Model Prediction Perf", xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```

**Multiple lines in single plot**
  ``` {r}
par(mfrow=c(1,1)) 
plot(nb_perf_red, col="red", lwd=2, main="Wine Quality Label NB Model Prediction Perf (Full Dataset)", xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)

# par(new = TRUE)  # We draw on top of the existing plot.
# plot(perf, col = "red", lwd=2, main="", xlab="", ylab="")

par(new = TRUE)  # We draw on top of the existing plot.
plot(nb_perf_white, col = "blue", lwd=2, main="", xlab="", ylab="")

legend("topleft",
       legend = c("Red Wine", "White Wine"),
       col = c("red", "blue"),
       pch = c(0, 0, 0))
```

**AUCs (Full Dataset)**
  ```{r}
print(paste0("AUC of NB Model (Red Wine Full Dataset):", nb_auc_red))
print(paste0("AUC of NB Model (White Wine Full Dataset):", nb_auc_white))
```



**Logistic Regression** 
  
  Aim: To predict whether the wine is above median quality or otherwise
- Hence the response variable would be the binary variable whether the wine is “good” or “bad”

How we chose the predictors:
  - Full model with all the predictors
- Violates the assumption that variables have to be independent from one another
- Good for comparison
- Remove correlated variables for a reduced model as per EDA
- Fulfills all the assumptions

Split the data into training data and testing data into 80/20 percent of the dataset respectively.
- Model is created using training data
- ROC curve and AUC is derived using testing data
- Done to ensure overfitting does not happen

**Red Wine** 
  
  **Full Model** 
  
  ```{r}



red_lr_train <- glm(formula = label_binary ~ 
                      fixed.acidity + volatile.acidity + citric.acid
                    + residual.sugar + chlorides + free.sulfur.dioxide
                    + total.sulfur.dioxide + density + pH 
                    + sulphates + alcohol, data = traindata_red_full,
                    family = binomial(link="logit"))

summary(red_lr_train)

pred = predict.glm(red_lr_train,testdata_red_full,  type="response")
predObj <- prediction(pred, testdata_red_full$label_binary)
rocObj = performance(predObj, measure="tpr", x.measure="fpr")
aucObj = performance(predObj, measure="auc")
plot(rocObj, main = paste("Area under the curve:",
                          round(aucObj@y.values[[1]] ,4)))
lr_auc_red <- round(aucObj@y.values[[1]] ,4)


```

**Reduced Model** 
  
  ```{r}

red_lr_train_reduced <- glm(formula = label_binary ~ 
                              citric.acid
                            + residual.sugar + chlorides + free.sulfur.dioxide
                            + sulphates + alcohol, data = traindata_red_reduced,
                            family = binomial(link="logit"))

summary(red_lr_train_reduced)

pred = predict.glm(red_lr_train_reduced, testdata_red_reduced,  type="response")
predObj <- prediction(pred, testdata_red_reduced$label_binary)
rocObj = performance(predObj, measure="tpr", x.measure="fpr")
aucObj = performance(predObj, measure="auc")
plot(rocObj, main = paste("Area under the curve:",
                          round(aucObj@y.values[[1]] ,4)))
lr_perf_red_reduced <- rocObj
lr_auc_red_reduced <- round(aucObj@y.values[[1]] ,4)

```

```{r}

# Select only numeric predictors
mydata <- data_redwine_reduced_labelled %>%
  dplyr::select_if(is.numeric) 
predictors <- colnames(mydata)
probabilities <- predict(red_lr_train_reduced, newdata = data_redwine_reduced_labelled ,type = "response")
# Bind the logit and tidying the data for plot
mydata <- mydata %>%
  mutate(logit = log(probabilities/(1-probabilities))) %>%
  gather(key = "predictors", value = "predictor.value", -logit)

ggplot(mydata, aes(logit, predictor.value))+
  geom_point(size = 0.5, alpha = 0.5) +
  geom_smooth(method = "loess") + 
  theme_bw() + 
  facet_wrap(~predictors, scales = "free_y")



```



**White Wine** 
  
  **Full Model** 
  
  ```{r}

white_lr_train <- glm(formula = label_binary ~ 
                        fixed.acidity + volatile.acidity + citric.acid
                      + residual.sugar + chlorides + free.sulfur.dioxide
                      + total.sulfur.dioxide + density + pH 
                      + sulphates + alcohol, data = traindata_white_full,
                      family = binomial(link="logit"))

summary(white_lr_train)

pred = predict.glm(white_lr_train, testdata_white_full,  type="response")
predObj <- prediction(pred, testdata_white_full$label_binary)
rocObj = performance(predObj, measure="tpr", x.measure="fpr")
aucObj = performance(predObj, measure="auc")
plot(rocObj, main = paste("Area under the curve:",
                          round(aucObj@y.values[[1]] ,4)))

lr_auc_white <- round(aucObj@y.values[[1]] ,4)


```

**Reduced Model** 
  
  ```{r}

white_lr_train_reduced <- glm(formula = label_binary ~ 
                                fixed.acidity + volatile.acidity + citric.acid
                              + residual.sugar + chlorides + free.sulfur.dioxide
                              + sulphates, data = traindata_white_reduced,
                              family = binomial(link="logit"))

summary(white_lr_train_reduced)

pred = predict.glm(white_lr_train_reduced, testdata_white_reduced,  type="response")
predObj <- prediction(pred, testdata_white_reduced$label_binary)
rocObj = performance(predObj, measure="tpr", x.measure="fpr")
aucObj = performance(predObj, measure="auc")
plot(rocObj, main = paste("Area under the curve:",
                          round(aucObj@y.values[[1]] ,4)))

lr_perf_white_reduced <- rocObj
lr_auc_white_reduced <- round(aucObj@y.values[[1]] ,4)
```


```{r}

# Select only numeric predictors
mydata <- data_whitewine_reduced_labelled %>%
  dplyr::select_if(is.numeric) 
predictors <- colnames(mydata)
probabilities <- predict(white_lr_train_reduced, newdata = data_whitewine_reduced_labelled ,type = "response")
# Bind the logit and tidying the data for plot
mydata <- mydata %>%
  mutate(logit = log(probabilities/(1-probabilities))) %>%
  gather(key = "predictors", value = "predictor.value", -logit)

ggplot(mydata, aes(logit, predictor.value))+
  geom_point(size = 0.5, alpha = 0.5) +
  geom_smooth(method = "loess") + 
  theme_bw() + 
  facet_wrap(~predictors, scales = "free_y")


```

**Decision Trees**  
  
  ```{r}
# Red wine (reduced dataset)
dt_fit_red_reduced  <- rpart(label ~ citric.acid
                             + residual.sugar + chlorides + free.sulfur.dioxide
                             + sulphates + alcohol, data=traindata_red_reduced,control=rpart.control(minsplit=128), method="class",
                             parms=list(split='information'))
summary(dt_fit_red_reduced)
rpart.plot(dt_fit_red_reduced, type=4, extra=1)

```


```{r}
dt_prediction_red_reduced <- predict(dt_fit_red_reduced, 
                                     testdata_red_reduced[, !(names(data_redwine_reduced_labelled) %in% c('label', 'label_binary'))],
                                     type='prob')

dt_pred_red_reduced <- prediction(dt_prediction_red_reduced[, 2], testdata_red_reduced$label)

dt_perf_red_reduced <- performance(dt_pred_red_reduced, "tpr", "fpr")


plot(dt_perf_red_reduced, col="red", lwd=2, xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```

```{r}
dt_auc_red_reduced <- performance(dt_pred_red_reduced, "auc")
dt_auc_red_reduced <- unlist(slot(dt_auc_red_reduced,"y.values"))          
dt_auc_red_reduced
```



```{r}
# White wine (reduced dataset)
dt_fit_white_reduced <- rpart(label_binary ~ . - label, 
                              data=traindata_white_reduced,
                              control=rpart.control(minsplit=390),
                              method="class", parms=list(split='information'))
summary(dt_fit_white_reduced)
rpart.plot(dt_fit_white_reduced , type=4, extra=1)

```


```{r}
# dt_pred_white_reduced <- prediction(predict(dt_fit_white_reduced, type = "prob")[, 2], data_whitewine_reduced_labelled$label)
# dt_perf_white_reduced <- performance(dt_pred_white_reduced, "tpr", "fpr")
# 
# 
# plot(dt_perf_white_reduced, col="blue", lwd=2, xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
# abline(a=0, b=1, col="gray50", lty=3)
```

```{r}
# dt_auc_white_reduced <- performance(dt_pred_white_reduced, "auc")
# dt_auc_white_reduced <- unlist(slot(dt_auc_white_reduced,"y.values"))          
# dt_auc_white_reduced
```


```{r}
# Red wine (full dataset)
dt_fit_red_full  <- rpart(label ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides + free.sulfur.dioxide + total.sulfur.dioxide + density + pH + sulphates + alcohol, data=traindata_red_full,control=rpart.control(minsplit=128), method="class",
                          parms=list(split='information'))
summary(dt_fit_red_full)
rpart.plot(dt_fit_red_full, type=4, extra=1)
```


```{r}
dt_prediction_red_full <- predict(dt_fit_red_full, 
                                  testdata_red_full[, !(names(data_red_wine_labelled) %in% c('label', 'label_binary'))],
                                  type='prob')

dt_pred_red_full <- prediction(dt_prediction_red_full[, 2], testdata_red_full$label)

dt_perf_red_full <- performance(dt_pred_red_full, "tpr", "fpr")


plot(dt_perf_red_full, col="red", lwd=2, xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```

```{r}
dt_auc_red_full <- performance(dt_pred_red_full, "auc")
dt_auc_red_full <- unlist(slot(dt_auc_red_full,"y.values"))          
dt_auc_red_full
```



```{r}
# White wine (full dataset)
dt_fit_white_full  <- rpart(label ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides + free.sulfur.dioxide + total.sulfur.dioxide + density + pH + sulphates + alcohol, data=traindata_white_full,control=rpart.control(minsplit=390), method="class",
                            parms=list(split='information'))
summary(dt_fit_white_full )
rpart.plot(dt_fit_white_full , type=4, extra=1)
```


```{r}
dt_prediction_white_full <- predict(dt_fit_white_full, 
                                    testdata_white_full[, !(names(data_white_wine_labelled) %in% c('label', 'label_binary'))],
                                    type='prob')

dt_pred_white_full <- prediction(dt_prediction_white_full[, 2], testdata_white_full$label)

dt_perf_white_full <- performance(dt_pred_white_full, "tpr", "fpr")


plot(dt_perf_white_full, col="blue", lwd=2, xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)
```

```{r}
dt_auc_white_full <- performance(dt_pred_white_full, "auc")
dt_auc_white_full <- unlist(slot(dt_auc_white_full,"y.values"))          
dt_auc_white_full
```


**Evaluating Classifiers**
  
  Comparing AUC values:  
  ```{r}
print(paste0("AUC of Naive Bayes Model (Red Wine Reduced Dataset):", nb_auc_red_reduced))
print(paste0("AUC of Decision Tree Model (Red Wine Reduced Dataset):", dt_auc_red_reduced))
print(paste0("AUC of Logistic Regression Model (Red Wine Reduced Dataset):", lr_auc_red_reduced))

print(paste0("AUC of Naive Bayes Model (White Wine Reduced Dataset):", nb_auc_white_reduced))
# print(paste0("AUC of Decision Tree Model (White Wine Reduced Dataset):", dt_auc_white_reduced))
print(paste0("AUC of Logistic Regression Model (White Wine Reduced Dataset):", lr_auc_white_reduced))
```

**Combining AOCs in single plot**
  ``` {r}
par(mfrow=c(1,1)) 
plot(nb_perf_red_reduced, col="darkred", lwd=2, main="Wine Quality Label NB Model Prediction Perf (Full Dataset)", xlab="False Positive Rate (FPR)", ylab="True Positive Rate (TPR)")
abline(a=0, b=1, col="gray50", lty=3)

# par(new = TRUE)  # We draw on top of the existing plot.
# plot(perf, col = "red", lwd=2, main="", xlab="", ylab="")

par(new = TRUE)  # We draw on top of the existing plot.
plot(nb_perf_white_reduced, col = "blue", lwd=2, main="", xlab="", ylab="")

par(new = TRUE)  # We draw on top of the existing plot.
plot(dt_perf_red_reduced, col = "red", lwd=2, lty=2, main="", xlab="", ylab="")

# par(new = TRUE)  # We draw on top of the existing plot.
# plot(dt_perf_white_reduced, col = "blue", lwd=2, lty=2, main="", xlab="", ylab="")

par(new = TRUE)  # We draw on top of the existing plot.
plot(lr_perf_red_reduced, col = "red", lwd=2, lty=3, main="", xlab="", ylab="")

par(new = TRUE)  # We draw on top of the existing plot.
plot(lr_perf_white_reduced, col = "darkblue", lwd=2, lty=3, main="", xlab="", ylab="")

legend("topright",
       legend = c("Red Wine (NB)", "White Wine(NB)", "Red Wine (DT)", "White Wine(DT)", "Red Wine (LR)", "White Wine(LR)"),
       col = c("darkred", "darkblue", "red", "blue", "red", "blue"),
       lty = c(1, 1, 2, 2, 3, 3))
```


**Stepwise Regression** 
  
  We use stepwise regression using logistic regression focusing on p-values in order to determine the significant variables that affect the quality of wine (using quality above median as the binary response variable)

Since we use logistic regression using stepwise regression, we must make sure that variables are independent from one another, i.e none of the variables are heavily correlated with each other, so we use the reduced predictor set as explained in our EDA.

We want the most significant variables, so the p-value threshold is set at 0.001.
Both backward elimination and forward selection are considered.


**Red Wine**
  
  data_redwine_reduced_labelled

**Back Elimination**
  
  ```{r}

red_new_lr <- glm(formula = data_redwine_reduced_labelled$label_binary ~ 
                    data_redwine_reduced_labelled$citric.acid
                  + data_redwine_reduced_labelled$residual.sugar + data_redwine_reduced_labelled$chlorides + data_redwine_reduced_labelled$free.sulfur.dioxide
                  + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$alcohol,
                  family = binomial(link="logit"))

summary(red_new_lr)

```

As we can see residual.sugar has the highest p-val of 0.630051, so we remove it.

```{r}

red_new_lr_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ 
                      data_redwine_reduced_labelled$citric.acid + data_redwine_reduced_labelled$chlorides + data_redwine_reduced_labelled$free.sulfur.dioxide
                    + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$alcohol,
                    family = binomial(link="logit"))

summary(red_new_lr_2)

```

As we can see free.sulfur.dioxide has the highest p-val of 0.026230, so we remove it.

```{r}

red_new_lr_3 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ 
                      data_redwine_reduced_labelled$citric.acid + data_redwine_reduced_labelled$chlorides
                    + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$alcohol,
                    family = binomial(link="logit"))

summary(red_new_lr_3)

```

None of the variables have a p-value lower than 0.001, so we stop here.

Significant variables:
  - citric.acid
- chlorides
- sulphates
- alcohol

**Forward Selection **
  
  
  ```{r}

red_lr_new_fs1_1 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$citric.acid,
                        family = binomial(link="logit"))

red_lr_new_fs1_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$residual.sugar,
                        family = binomial(link="logit"))

red_lr_new_fs1_3 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$chlorides,
                        family = binomial(link="logit"))

red_lr_new_fs1_4 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$free.sulfur.dioxide,
                        family = binomial(link="logit"))

red_lr_new_fs1_5 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$sulphates,
                        family = binomial(link="logit"))

red_lr_new_fs1_6 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol,
                        family = binomial(link="logit"))

summary(red_lr_new_fs1_1)$coef
summary(red_lr_new_fs1_2)$coef
summary(red_lr_new_fs1_3)$coef
summary(red_lr_new_fs1_4)$coef
summary(red_lr_new_fs1_5)$coef
summary(red_lr_new_fs1_6)$coef


```

As we can see alcohol has the lowest p-val of 9.756085e-45, so we include it.

```{r}

red_lr_new_fs2_1 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$citric.acid,
                        family = binomial(link="logit"))

red_lr_new_fs2_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$residual.sugar,
                        family = binomial(link="logit"))

red_lr_new_fs2_3 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$chlorides,
                        family = binomial(link="logit"))

red_lr_new_fs2_4 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$free.sulfur.dioxide,
                        family = binomial(link="logit"))

red_lr_new_fs2_5 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates,
                        family = binomial(link="logit"))

summary(red_lr_new_fs2_1)$coef
summary(red_lr_new_fs2_2)$coef
summary(red_lr_new_fs2_3)$coef
summary(red_lr_new_fs2_4)$coef
summary(red_lr_new_fs2_5)$coef


```

As we can see sulphates has the lowest p-val of 1.598385e-13, so we include it.

```{r}

red_lr_new_fs3_1 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates +  data_redwine_reduced_labelled$citric.acid,
                        family = binomial(link="logit"))

red_lr_new_fs3_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates +  data_redwine_reduced_labelled$residual.sugar,
                        family = binomial(link="logit"))

red_lr_new_fs3_3 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates +  data_redwine_reduced_labelled$chlorides,
                        family = binomial(link="logit"))

red_lr_new_fs3_4 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates +  data_redwine_reduced_labelled$free.sulfur.dioxide,
                        family = binomial(link="logit"))


summary(red_lr_new_fs3_1)$coef
summary(red_lr_new_fs3_2)$coef
summary(red_lr_new_fs3_3)$coef
summary(red_lr_new_fs3_4)$coef


```

As we can see citric.acid has the lowest p-val of 3.853376e-08, so we include it.

```{r}


red_lr_new_fs4_1 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$citric.acid +  data_redwine_reduced_labelled$residual.sugar,
                        family = binomial(link="logit"))

red_lr_new_fs4_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$citric.acid +  data_redwine_reduced_labelled$chlorides,
                        family = binomial(link="logit"))

red_lr_new_fs4_3 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$citric.acid +  data_redwine_reduced_labelled$free.sulfur.dioxide,
                        family = binomial(link="logit"))


summary(red_lr_new_fs4_1)$coef
summary(red_lr_new_fs4_2)$coef
summary(red_lr_new_fs4_3)$coef


```

As we can see chlorides has the lowest p-val of 6.075525e-04, so we include it.


```{r}


red_lr_new_fs5_1 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$citric.acid + data_redwine_reduced_labelled$chlorides +  data_redwine_reduced_labelled$residual.sugar,
                        family = binomial(link="logit"))

red_lr_new_fs5_2 <- glm(formula = data_redwine_reduced_labelled$label_binary ~ data_redwine_reduced_labelled$alcohol + data_redwine_reduced_labelled$sulphates + data_redwine_reduced_labelled$citric.acid + data_redwine_reduced_labelled$chlorides +  data_redwine_reduced_labelled$free.sulfur.dioxide,
                        family = binomial(link="logit"))


summary(red_lr_new_fs5_1)$coef
summary(red_lr_new_fs5_2)$coef


```

As we can see, none of the variables have a p-value lower than 0.001, so we stop here.

Significant variables:
  - citric.acid
- chlorides
- sulphates
- alcohol

**White Wine**
  
  
  ```{r}

white_lr_new_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ 
                        data_whitewine_reduced_labelled$fixed.acidity + data_whitewine_reduced_labelled$volatile.acidity +
                        data_whitewine_reduced_labelled$citric.acid + data_whitewine_reduced_labelled$residual.sugar + data_whitewine_reduced_labelled$chlorides +
                        data_whitewine_reduced_labelled$free.sulfur.dioxide +  data_whitewine_reduced_labelled$sulphates,
                      family = binomial(link="logit"))

summary(white_lr_new_1)

```

As we can see citric.acid has the highest p-val of 0.401049, so we remove it.

```{r}

white_lr_new_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ 
                        data_whitewine_reduced_labelled$fixed.acidity + data_whitewine_reduced_labelled$volatile.acidity +
                        data_whitewine_reduced_labelled$residual.sugar + data_whitewine_reduced_labelled$chlorides +
                        data_whitewine_reduced_labelled$free.sulfur.dioxide +  data_whitewine_reduced_labelled$sulphates,
                      family = binomial(link="logit"))

summary(white_lr_new_2)

```

As we can see free.sulfur.dioxide has the highest p-val of 0.105479, so we remove it.

```{r}

white_lr_new_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ 
                        data_whitewine_reduced_labelled$fixed.acidity + data_whitewine_reduced_labelled$volatile.acidity +
                        data_whitewine_reduced_labelled$residual.sugar + data_whitewine_reduced_labelled$chlorides +  data_whitewine_reduced_labelled$sulphates,
                      family = binomial(link="logit"))

summary(white_lr_new_3)

```

None of the variables have a p-value lower than 0.001, so we stop here.

Significant variables:
  - fixed.acidity 
- volatile.acidity
- residual.sugar 
- chlorides
- sulphates 

**Forward Selection**
  
  ```{r}

white_lr_new_fs1_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$fixed.acidity,
                          family = binomial(link="logit"))

white_lr_new_fs1_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$volatile.acidity,
                          family = binomial(link="logit"))

white_lr_new_fs1_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$citric.acid,
                          family = binomial(link="logit"))

white_lr_new_fs1_4 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$residual.sugar,
                          family = binomial(link="logit"))

white_lr_new_fs1_5 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides,
                          family = binomial(link="logit"))

white_lr_new_fs1_6 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$free.sulfur.dioxide,
                          family = binomial(link="logit"))

white_lr_new_fs1_7 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$sulphates,
                          family = binomial(link="logit"))

summary(white_lr_new_fs1_1)$coef
summary(white_lr_new_fs1_2)$coef
summary(white_lr_new_fs1_3)$coef
summary(white_lr_new_fs1_4)$coef
summary(white_lr_new_fs1_5)$coef
summary(white_lr_new_fs1_6)$coef
summary(white_lr_new_fs1_7)$coef
```

As we can see  chlorides has the lowest p-val of 6.967899e-57, so we include it.

```{r}

white_lr_new_fs2_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$fixed.acidity,
                          family = binomial(link="logit"))

white_lr_new_fs2_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity,
                          family = binomial(link="logit"))

white_lr_new_fs2_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$citric.acid,
                          family = binomial(link="logit"))

white_lr_new_fs2_4 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$residual.sugar,
                          family = binomial(link="logit"))

white_lr_new_fs2_5 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$free.sulfur.dioxide,
                          family = binomial(link="logit"))

white_lr_new_fs2_6 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides +  data_whitewine_reduced_labelled$sulphates,
                          family = binomial(link="logit"))

summary(white_lr_new_fs2_1)$coef
summary(white_lr_new_fs2_2)$coef
summary(white_lr_new_fs2_3)$coef
summary(white_lr_new_fs2_4)$coef
summary(white_lr_new_fs2_5)$coef
summary(white_lr_new_fs2_6)$coef

```

As we can see volatile.acidity has the lowest p-val of 1.443031e-06, so we include it.

```{r}

white_lr_new_fs3_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity +  data_whitewine_reduced_labelled$fixed.acidity,
                          family = binomial(link="logit"))

white_lr_new_fs3_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity +  data_whitewine_reduced_labelled$citric.acid,
                          family = binomial(link="logit"))

white_lr_new_fs3_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity +  data_whitewine_reduced_labelled$residual.sugar,
                          family = binomial(link="logit"))

white_lr_new_fs3_4 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity +  data_whitewine_reduced_labelled$free.sulfur.dioxide,
                          family = binomial(link="logit"))

white_lr_new_fs3_5 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides +data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$sulphates,
                          family = binomial(link="logit"))

summary(white_lr_new_fs3_1)$coef
summary(white_lr_new_fs3_2)$coef
summary(white_lr_new_fs3_3)$coef
summary(white_lr_new_fs3_4)$coef
summary(white_lr_new_fs3_5)$coef

```

As we can see fixed.acidity has the lowest p-val of 7.237755e-06, so we include it.

```{r}

white_lr_new_fs4_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +   data_whitewine_reduced_labelled$citric.acid,
                          family = binomial(link="logit"))

white_lr_new_fs4_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$residual.sugar,
                          family = binomial(link="logit"))

white_lr_new_fs4_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity + data_whitewine_reduced_labelled$free.sulfur.dioxide,
                          family = binomial(link="logit"))

white_lr_new_fs4_4 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides +data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates,
                          family = binomial(link="logit"))

summary(white_lr_new_fs4_1)$coef
summary(white_lr_new_fs4_2)$coef
summary(white_lr_new_fs4_3)$coef
summary(white_lr_new_fs4_4)$coef

```

As we can see sulphates has the lowest p-val of 5.265491e-05, so we include it.


```{r}

white_lr_new_fs5_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates +   data_whitewine_reduced_labelled$citric.acid,
                          family = binomial(link="logit"))

white_lr_new_fs5_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates +  data_whitewine_reduced_labelled$residual.sugar,
                          family = binomial(link="logit"))

white_lr_new_fs5_3 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates +  data_whitewine_reduced_labelled$free.sulfur.dioxide,
                          family = binomial(link="logit"))

summary(white_lr_new_fs5_1)$coef
summary(white_lr_new_fs5_2)$coef
summary(white_lr_new_fs5_3)$coef

```

As we can see residual.sugar has the lowest p-val of 3.793700e-04, so we include it.


```{r}

white_lr_new_fs6_1 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates + data_whitewine_reduced_labelled$residual.sugar +  data_whitewine_reduced_labelled$citric.acid,
                          family = binomial(link="logit"))

white_lr_new_fs6_2 <- glm(formula = data_whitewine_reduced_labelled$label_binary ~ data_whitewine_reduced_labelled$chlorides + data_whitewine_reduced_labelled$volatile.acidity + data_whitewine_reduced_labelled$fixed.acidity +  data_whitewine_reduced_labelled$sulphates + data_whitewine_reduced_labelled$residual.sugar +  data_whitewine_reduced_labelled$free.sulfur.dioxide,
                          family = binomial(link="logit"))

summary(white_lr_new_fs6_1)$coef
summary(white_lr_new_fs6_2)$coef

```

None of the variables have a p-value lower than 0.001, so we stop here.

Significant variables:
  - chlorides
- volatile.acidity
- fixed.acidity 
- sulphates
- residual.sugar


